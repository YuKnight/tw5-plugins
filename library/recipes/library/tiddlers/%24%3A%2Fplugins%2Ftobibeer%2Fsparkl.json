{
    "title": "$:/plugins/tobibeer/sparkl",
    "description": "A widget and macro for inline sparkline diagrams",
    "author": "Tobias Beer",
    "version": "0.5.0",
    "core-version": ">=5.1.9",
    "source": "https://github.com/tobibeer/tw5-sparkl",
    "documentation": "https://tobibeer.github.io/tw5-sparkl",
    "plugin-type": "plugin",
    "requires": "",
    "list": "readme defaults styles",
    "dependents": "",
    "type": "application/json",
    "text": "{\n    \"tiddlers\": {\n        \"$:/plugins/tobibeer/sparkl/css\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/css\",\n            \"tags\": \"$:/tags/Stylesheet\",\n            \"text\": \"\\\\define color(id) {{$:/plugins/tobibeer/sparkl/defaults/colors/$id$}}\\n\\n.tc-sparkl{\\r\\n\\tborder: 0;\\r\\n\\tbackground:  <<color bg>>;\\r\\n}\\n\\n.tc-sparkl-bar {\\r\\n\\theight:1em;\\r\\n\\tdisplay:inline-block;\\r\\n\\toverflow:hidden;\\r\\n}\\n\\n.tc-sparkl-bar b {\\r\\n\\toutline: 0;\\r\\n\\theight:0;\\r\\n\\tdisplay:inline-block;\\r\\n\\tvertical-align: top;\\r\\n\\tborder-left-color:transparent;\\r\\n\\tborder-top-color:transparent;\\r\\n\\tborder-top-style:solid;\\r\\n\\tborder-bottom: 2em solid <<color fg>>;\\r\\n\\tbackground: transparent;\\r\\n\\tbox-sizing:content-box;\\r\\n}\\n\\n.tc-sparkl-bar:hover b{\\r\\n\\tborder-top-color: <<color bg-hover>>;\\r\\n\\tborder-bottom-color: <<color fg-hover>>;\\r\\n}\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/default\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/default\",\n            \"text\": \"0\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/min\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/min\",\n            \"text\": \"0\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/max\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/max\",\n            \"text\": \"max\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/margin\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/margin\",\n            \"text\": \"1px\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/width\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/width\",\n            \"text\": \"3px\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/segments\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/segments\",\n            \"text\": \"20\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/link\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/link\",\n            \"text\": \"yes\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/colors/fg\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/colors/fg\",\n            \"text\": \"<<colour primary>>\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/colors/bg\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/colors/bg\",\n            \"text\": \"transparent\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/colors/fg-hover\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/colors/fg-hover\",\n            \"text\": \"<<colour message-foreground>>\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults/colors/bg-hover\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults/colors/bg-hover\",\n            \"text\": \"<<colour message-background>>\"\n        },\n        \"$:/plugins/tobibeer/sparkl/defaults\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/defaults\",\n            \"text\": \"<dl>\\r\\n<$list filter=\\\"[all[system+shadows]prefix[$:/plugins/tobibeer/sparkl/defaults/]]\\\">\\r\\n<dt><$link><$view field=\\\"title\\\"/></$link></dt>\\r\\n<dd><code><$text text={{!!text}}/></code></dd>\\r\\n</$list>\\r\\n</dl>\"\n        },\n        \"$:/plugins/tobibeer/sparkl/macro\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/macro\",\n            \"tags\": \"$:/tags/Macro\",\n            \"text\": \"\\\\define sparkl(values,titles,class,default,min,max,width,margin,segments,link)\\r\\n<$sparkl\\r\\nvalues=\\\"\\\"\\\"$values$\\\"\\\"\\\"\\r\\ntitles=\\\"\\\"\\\"$titles$\\\"\\\"\\\"\\r\\nclass=\\\"\\\"\\\"$class$\\\"\\\"\\\"\\r\\ndefault=\\\"\\\"\\\"$default$\\\"\\\"\\\"\\r\\nmin=\\\"\\\"\\\"$min$\\\"\\\"\\\"\\r\\nmax=\\\"\\\"\\\"$max$\\\"\\\"\\\"\\r\\nwidth=\\\"\\\"\\\"$width$\\\"\\\"\\\"\\r\\nmargin=\\\"\\\"\\\"$margin$\\\"\\\"\\\"\\r\\nsegments=\\\"\\\"\\\"$segments$\\\"\\\"\\\"\\r\\nlink=\\\"\\\"\\\"$link$\\\"\\\"\\\"/>\\r\\n\\\\end\"\n        },\n        \"$:/plugins/tobibeer/sparkl/readme\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/readme\",\n            \"text\": \"\\\\define D(v,d)\\r\\n<$vars v=\\\"$:/plugins/tobibeer/sparkl/defaults/$v$\\\">\\r\\n''$v$'': $d$ <$list filter=\\\"[<v>shadowsource[]]\\\" variable=\\\"none\\\"> / default: <code><$view tiddler=<<v>>/></code></$list>\\r\\n</$vars>\\r\\n\\\\end\\n\\nThe plugin $:/plugins/tobibeer/sparkl provides:\\n\\n; <$text text=\\\"<$sparkl/>\\\"/>\\r\\n: a widget to render simple sparkline diagrams\\n\\n; Attributes\\r\\n: <<D values \\\"space separated values<br>&nbsp;&nbsp;&nbsp;Â» or a filter like `[[%title%]get[number]]` for each `%title%` in ''titles''\\\">>\\r\\n: <<D titles \\\"filter for titles\\\">>\\r\\n: <<D class \\\"css class\\\">>\\r\\n: <<D default \\\"default when no value for field\\\">>\\r\\n: <<D min \\\"defined min for scale\\\">>\\r\\n: <<D max \\\"defined max for scale\\\">>\\r\\n: <<D width \\\"of a bar\\\">>\\r\\n: <<D margin \\\"left margin for a bar\\\">>\\r\\n: <<D segments \\\"accuracy of the scale\\\">>\\r\\n: <<D link \\\"links bars to titles\\\">>\\n\\n; <$text text=\\\"<<sparkl values titles class default min max width margin segments>>\\\"/>\\r\\n: a simple macro wrapper\\n\\n<br>\\n\\n; documentation / examples / demos...\\r\\n: http://tobibeer.github.io/tw5-plugins#sparkl\"\n        },\n        \"$:/plugins/tobibeer/sparkl/styles\": {\n            \"title\": \"$:/plugins/tobibeer/sparkl/styles\",\n            \"text\": \"$:/plugins/tobibeer/sparkl/styles\\n\\n<pre><$text text={{$:/plugins/tobibeer/sparkl/css}}/></pre>\"\n        },\n        \"$:/plugins/tobibeer/sparkl/widget.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/tobibeer/sparkl/widget.js\\r\\ntype: application/javascript\\r\\nmodule-type: widget\\r\\n\\r\\nThe sparkl widget renders simple inline sparkline diagrams\\r\\n\\r\\n@preserve\\r\\n\\\\*/\\n(function(){\\\"use strict\\\";var t=require(\\\"$:/core/modules/widgets/widget.js\\\").widget,e=function(t,e){this.initialise(t,e)};e.prototype=new t;e.prototype.render=function(t,e){this.parentDomNode=t;this.nextSibling=e;this.computeAttributes();this.execute();var i=this,s,r,l,a,n,u,d,h,f,p,o,g=[],m,c,b=[],k,w,x=i.wiki.getTiddlerText(\\\"$:/plugins/tobibeer/sparkl/defaults/default\\\");if(!i.values||!i.titles&&i.filter){return}if(i.titles){$tw.utils.each(i.wiki.filterTiddlers(i.titles,i),function(t){g.push(t)})}$tw.utils.each(i.filter?g:i.values.split(\\\" \\\"),function(t){if(i.filter){t=i.wiki.filterTiddlers(i.values.replace(/%title%/gm,t),i);if(!t.length||isNaN(parseFloat(t[0],10))){t=i.default||x}else{t=t[0]}}t=parseFloat(t,10);if(isNaN(t)){t=0}if(h===undefined){h=t;u=t}if(u<t){u=t}if(h>t){h=t}b.push(t)});if(!b.length){return}a=i.link||i.filter?i.link===\\\"\\\"?i.wiki.getTiddlerText(\\\"$:/plugins/tobibeer/sparkl/defaults/link\\\"):[\\\"false\\\",\\\"no\\\"].indexOf(i.link)>=0?0:1:0;d=i.max?i.max:i.wiki.getTiddlerText(\\\"$:/plugins/tobibeer/sparkl/defaults/max\\\");if(d!==\\\"max\\\"){u=parseInt(d,10)}f=i.min?i.min:i.wiki.getTiddlerText(\\\"$:/plugins/tobibeer/sparkl/defaults/min\\\");if(f!==\\\"min\\\"){if(f.charAt(f.length-1)===\\\"%\\\"){h=h-(u-h)*parseInt(f.substr(0,f.length-1),10)/100}else{h=parseInt(f,10)}}p=parseInt(i.segments,10);if(isNaN(p)){p=parseInt(i.wiki.getTiddlerText(\\\"$:/plugins/tobibeer/sparkl/defaults/segments\\\"),10)||20}n=i.margin||i.wiki.getTiddlerText(\\\"$:/plugins/tobibeer/sparkl/defaults/margin\\\")||0;w=i.width||i.wiki.getTiddlerText(\\\"$:/plugins/tobibeer/sparkl/defaults/width\\\")||\\\"3px\\\";switch(b.length){case 1:w=\\\"1em\\\";break;case 2:w=\\\"0.5em\\\";break;case 3:w=\\\"0.33em\\\";break}s=i.document.createElement(\\\"span\\\");s.textContent=String.fromCharCode(160);l=i.classes?i.classes.split(\\\" \\\"):[];l.push(\\\"tc-sparkl\\\");s.className=l.join(\\\" \\\");t.insertBefore(s,e);for(m=0;m<b.length;m++){o=g[m];if(a){k=document.createElement(\\\"a\\\");k.setAttribute(\\\"href\\\",\\\"#\\\"+g[m]);k.style.cursor=\\\"pointer\\\"}else{k=document.createElement(\\\"span\\\")}k.className=\\\"tc-sparkl-bar\\\";k.title=o?o+\\\" (\\\"+b[m]+\\\")\\\":b[m];r=document.createElement(\\\"b\\\");r.style.width=w;c=u===h?0:1-(b[m]-h)/(u-h);c=Math.max(0,c);c=Math.round(p*c)/p;r.style.borderTopWidth=c+\\\"em\\\";r.style.marginLeft=n;k.appendChild(r);s.appendChild(k)}};e.prototype.execute=function(){this.values=this.getAttribute(\\\"values\\\");this.titles=this.getAttribute(\\\"titles\\\");this.default=this.getAttribute(\\\"default\\\");this.classes=this.getAttribute(\\\"class\\\");this.min=this.getAttribute(\\\"min\\\");this.max=this.getAttribute(\\\"max\\\");this.segments=this.getAttribute(\\\"segments\\\");this.width=this.getAttribute(\\\"width\\\");this.margin=this.getAttribute(\\\"margin\\\");this.link=(this.getAttribute(\\\"link\\\")||\\\"\\\").toLowerCase();if(this.values.indexOf(\\\"%title%\\\")>=0){this.filter=1}};e.prototype.refresh=function(){var t=this.computeAttributes();if(t.values||t.titles||t[\\\"class\\\"]||t.default||t.min||t.max||t.width||t.margin||t.segments||t.link){this.refreshSelf();return true}else{return false}};exports.sparkl=e})();\",\n            \"title\": \"$:/plugins/tobibeer/sparkl/widget.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"widget\"\n        }\n    }\n}"
}